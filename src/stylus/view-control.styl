/******************************************************************************\

                  This file is part of the Buildbotics firmware.

         Copyright (c) 2015 - 2023, Buildbotics LLC, All rights reserved.

          This Source describes Open Hardware and is licensed under the
                                  CERN-OHL-S v2.

          You may redistribute and modify this Source and make products
     using it under the terms of the CERN-OHL-S v2 (https:/cern.ch/cern-ohl).
            This Source is distributed WITHOUT ANY EXPRESS OR IMPLIED
     WARRANTY, INCLUDING OF MERCHANTABILITY, SATISFACTORY QUALITY AND FITNESS
      FOR A PARTICULAR PURPOSE. Please see the CERN-OHL-S v2 for applicable
                                   conditions.

                 Source location: https://github.com/buildbotics

       As per CERN-OHL-S v2 section 4, should You produce hardware based on
     these sources, You must maintain the Source Location clearly visible on
     the external case of the CNC Controller or other product you make using
                                   this Source.

                 For more information, email info@buildbotics.com

\******************************************************************************/

.view-control
  max-width limit-width
  margin auto

  #control
    display flex
    flex-direction column

    > *
      margin 0.25em 0  // Reduced from 0.5em for tighter layout

    .info-blocks
      display grid
      grid-template-columns auto auto auto
      column-gap 1em
      row-gap 0.5em

  table
    border-collapse collapse

    td, th
      border 1px solid #ddd

  // =====================================================
  // AXIS TABLE
  // =====================================================
  .axes
    .axis-x .name
      color #f00

    .axis-y .name
      color #0f0

    .axis-z .name
      color #00f

    .axis-a .name
      color #f80

    .axis-b .name
      color #0ff

    .axis-c .name
      color #f0f

    td, th
      padding 4px 8px  // Reduced from 6px 10px for tighter layout
      white-space nowrap

    th
      text-align center
      vertical-align bottom
      background #f8f8f8
      font-weight 600
      color #555

    td
      text-align right
      font-family Courier

    .homed
      background-color #ccffcc
      color #000

    .warn
      background-color #ffffcc

    .error
      background-color #ffcccc

    .axis
      .name
        text-transform capitalize
        min-width 2.5em
        font-weight 600

      .name, .position
        font-size 24pt
        line-height 28pt

      .position
        width auto
        min-width 5em

      td.state
        text-align left
        min-width 6em
        font-family inherit
        font-size 0.9em

      .absolute, .offset
        min-width 5em
        font-size 0.95em

    // Header row
    tr:first-child
      th
        font-size 0.85em
        text-transform uppercase
        letter-spacing 0.5px
        
      th.actions
        text-align right
        
        button, .bbutton
          font-size 1rem

    // Action buttons - compact column, normal font weight
    .actions
      white-space nowrap
      text-align right
      width 1%
      
      button, .bbutton
        margin-left 4px
        font-weight normal

      // Desktop: show inline buttons, hide dropdown
      .actions-inline
        display flex
        gap 4px
        justify-content flex-end
        
      .actions-dropdown
        display none
        position relative
        
        > .nav-item
          padding 0.5em
          cursor pointer
          color #555
          
          > .fa-ellipsis-v
            font-size 1.2em
            
          &:hover
            background rgba(0,0,0,0.05)
            
          // Show menu on click
          > .nav-menu.nav-menu-open
            display block
            
          > .nav-menu
            display none
            position absolute
            top 100%
            right 0
            left auto
            min-width 140px
            background #fff
            border 1px solid #ddd
            border-radius 4px
            box-shadow 0 4px 12px rgba(0,0,0,0.15)
            z-index 100
            
            // Menu items - override th font-weight inheritance
            > a
              padding 0.6em 1em
              display flex
              align-items center
              gap 0.5em
              color #333
              white-space nowrap
              text-decoration none
              font-weight normal  // Fix: override bold from th
              
              &:hover
                background #f5f5f5
              
              &.disabled
                opacity 0.5
                pointer-events none
                
              .fa
                width 1.2em
                color #666

  // =====================================================
  // JOG CONTROLS
  // =====================================================
  .jog svg
    user-select none
    -webkit-touch-callout none
    -webkit-user-select none
    -khtml-user-select none
    -moz-user-select none
    -ms-user-select none

    text
      font-family Sans
      font-weight bold
      stroke transparent
      fill #444

    .button
      cursor pointer
      stroke #4c4c4c

      &:hover
        stroke #e55

      path
        overflow visible

    .house
      stroke #444
      fill #444

    .ring
      cursor pointer
      overflow visible

      .button
        stroke transparent

        &:hover
          stroke #e55

        text
          font-size 10pt
          text-anchor middle

  // =====================================================
  // MACRO BUTTONS (in control page)
  // =====================================================
  .macros
    display grid
    grid-template-columns repeat(8, 1fr)
    column-gap 1%
    row-gap 8px
    padding 0.5em

    // FIX: Button text overflow - allow text to wrap
    .macro
      text-align center
      overflow hidden
      // FIX: Remove text-overflow ellipsis and white-space nowrap
      // to allow long names to wrap to multiple lines
      white-space normal
      word-wrap break-word
      overflow-wrap break-word
      padding 0.5em 0.25em
      min-height 2.5em
      display flex
      align-items center
      justify-content center
      font-size 14px
      line-height 1.2

      &:hover
        background-image button-hover

      .fa
        margin-right 0.25em

  // =====================================================
  // INFO TABLES
  // =====================================================
  .info
    empty-cells show
    background #fff
    border-radius 4px

    th, td
      height 1.5em  // Reduced from 1.75em
      padding 4px 8px  // Reduced from 6px 10px
      text-align right
      overflow hidden
      text-overflow ellipsis
      white-space nowrap

    th
      min-width 5.5em
      width 5.5em
      background #f8f8f8
      font-weight 600
      color #555

    td
      min-width 7em
      width 100%

    .progress
      height 1.75em
      position relative

      label
        position relative
        z-index 1
        float right

      .bar
        position absolute
        top 0
        left 0
        height 100%
        background #f2ac45
        border-radius 2px

  // =====================================================
  // AUTO TAB TOOLBAR
  // =====================================================
  .toolbar
    display flex
    flex-wrap wrap
    clear both
    padding 0.5em
    background #f5f5f5
    border-radius 4px
    margin-bottom 0.5em

    > *
      margin 0.25em 0.125em

    .filename
      flex 1
      text-align right
      color #666
      font-style italic
      align-self center

  // =====================================================
  // TABS
  // =====================================================
  .tabs
    section
      min-height 400px  // Reduced from 500px for tighter layout
      overflow-x hidden
      overflow-y auto
      padding 0
      margin 0

  .CodeMirror
    height 460px

  .gcode-view, .history
    font-family courier
    overflow auto
    height 450px
    white-space nowrap

    &.placeholder
      color #aaa

  .history
    padding 0.5em
    background #fafafa
    border-radius 4px

  .history ul
    margin 0
    padding 0
    list-style none

    li
      cursor pointer
      padding 0.25em 0.5em
      border-radius 3px
      
      &:hover
        background #e8e8e8

  // =====================================================
  // MDI
  // =====================================================
  .mdi
    clear both
    white-space nowrap
    padding 0.5em
    display flex
    background #f5f5f5
    border-radius 4px
    gap 0.5em

    button, .bbutton
      flex-shrink 0

    input
      flex 1
      padding 0.5em
      border 1px solid #ccc
      border-radius 4px
      font-family monospace

  // =====================================================
  // JOG
  // =====================================================
  .jog
    text-align center

    > svg
      margin 1em
      
      // Visual feedback when jog controls are disabled (program running)
      &.disabled
        opacity 0.4
        pointer-events none
        cursor not-allowed

  .jog-settings
    display flex
    justify-content center
    gap 2em
    margin 1em 0
    
  .jog-adjust, .jog-mode
    display flex
    align-items center
    gap 0.5em

  .jog-adjust input
    vertical-align middle

  .jog-instructions
    text-align center
    color #666
    font-size 0.9em
    
    p
      margin 0.5em 0

.load-on
  background-color #ccffcc
  color #000


// =====================================================
// RESPONSIVE BREAKPOINTS
// =====================================================
@media only screen and (min-width 1350px)
  .view-control #control
    .macros
      grid-template-columns repeat(12, 1fr)

@media only screen and (max-width 970px)
  .view-control #control
    .path-viewer.small .path-viewer-content
      margin-top inherit
      float inherit

@media only screen and (max-width 940px)
  .view-control #control
    .axes
      .axis
        .name, .position
          font-size 18pt
          line-height 20pt

      .absolute, .offset
        display none

    .macros
      grid-template-columns repeat(6, 1fr)

    .info-blocks
      grid-template-columns auto

@media only screen and (max-width 570px)
  .view-control #control
    .macros
      grid-template-columns repeat(4, 1fr)
      
    .axes
      .axis
        .name, .position
          font-size 16pt
          line-height 18pt

      .actions
        .button-text
          display none
          
        // Mobile: hide inline buttons, show dropdown
        .actions-inline
          display none
          
        .actions-dropdown
          display block

  // Bottom padding for mobile browser chrome
  .view-control
    padding-bottom 80px
