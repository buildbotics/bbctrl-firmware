//-/////////////////////////////////////////////////////////////////////////////
//-                                                                           //
//-               This file is part of the Buildbotics firmware.              //
//-                                                                           //
//-      Copyright (c) 2015 - 2023, Buildbotics LLC, All rights reserved.     //
//-                                                                           //
//-       This Source describes Open Hardware and is licensed under the       //
//-                               CERN-OHL-S v2.                              //
//-                                                                           //
//-       You may redistribute and modify this Source and make products       //
//-  using it under the terms of the CERN-OHL-S v2 (https:/cern.ch/cern-ohl). //
//-         This Source is distributed WITHOUT ANY EXPRESS OR IMPLIED         //
//-  WARRANTY, INCLUDING OF MERCHANTABILITY, SATISFACTORY QUALITY AND FITNESS //
//-   FOR A PARTICULAR PURPOSE. Please see the CERN-OHL-S v2 for applicable   //
//-                                conditions.                                //
//-                                                                           //
//-              Source location: https://github.com/buildbotics              //
//-                                                                           //
//-    As per CERN-OHL-S v2 section 4, should You produce hardware based on   //
//-  these sources, You must maintain the Source Location clearly visible on  //
//-  the external case of the CNC Controller or other product you make using  //
//-                                this Source.                               //
//-                                                                           //
//-              For more information, email info@buildbotics.com             //
//-                                                                           //
//-/////////////////////////////////////////////////////////////////////////////

script#files-template(type="text/x-template")
  .files(v-if="fs.files")
    .files-name(v-if="mode == 'save'")
      label Name:
      input(v-model="filename", @input="filename_changed", focus)

    .files-body
      .files-box
        //- Breadcrumb path bar
        .files-path-bar
          .breadcrumbs
            //- Location selector (Home or USB drive)
            a.breadcrumb-location(@click="show_locations = !show_locations",
              :title="location_title(location)")
              .fa(:class="location == 'Home' ? 'fa-home' : 'fa-usb'")
              span {{location}}
              .fa.fa-caret-down
              
              //- Location dropdown
              .location-dropdown(v-if="show_locations")
                a.location-option(v-for="name in locations", @click.stop="open(name); show_locations = false",
                  :class="{active: name == location}")
                  .fa(:class="name == 'Home' ? 'fa-home' : 'fa-usb'")
                  span {{name}}
                  .fa.fa-eject.eject-btn(v-if="name != 'Home'", @click.stop="eject(name)",
                    title="Eject USB drive")
            
            //- Path segments
            template(v-for="path in paths")
              .fa.fa-chevron-right.path-separator
              a.breadcrumb-item(:class="{current: $index == paths.length - 1}",
                :title="path_title($index)", @click="load_path($index)")
                span {{path}}

        //- File list
        .files-list
          table
            thead
              tr
                th.col-name Name
                th.col-size Size
                th.col-modified Modified

            tbody
              tr.file-row(v-for="file in files",
                :class="{selected: $index == selected, directory: file.dir}",
                @click="select($index)", @dblclick="activate(file)")
                td.col-name
                  .fa(:class="file.dir ? 'fa-folder' : file_icon(file.name)")
                  span {{file.name}}
                td.col-size
                  span(v-if="!file.dir") {{file.size | size}}
                td.col-modified {{file.modified | ago}}

          .empty-message(v-if="!files.length")
            .fa.fa-folder-open-o
            p This folder is empty

    dialog.new-folder-dialog(v-ref:new-folder, header="Create New Folder",
      :buttons="['Cancel', {text: 'Create', disabled: !folder_valid}]")
      div(slot="body")
        .form-group
          label Folder Name
          input(v-model="folder", @keyup.enter="create_folder", focus,
            placeholder="Enter folder name...")
