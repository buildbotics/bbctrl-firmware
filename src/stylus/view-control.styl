/******************************************************************************\

                  This file is part of the Buildbotics firmware.

         Copyright (c) 2015 - 2023, Buildbotics LLC, All rights reserved.

          This Source describes Open Hardware and is licensed under the
                                  CERN-OHL-S v2.

          You may redistribute and modify this Source and make products
     using it under the terms of the CERN-OHL-S v2 (https:/cern.ch/cern-ohl).
            This Source is distributed WITHOUT ANY EXPRESS OR IMPLIED
     WARRANTY, INCLUDING OF MERCHANTABILITY, SATISFACTORY QUALITY AND FITNESS
      FOR A PARTICULAR PURPOSE. Please see the CERN-OHL-S v2 for applicable
                                   conditions.

                 Source location: https://github.com/buildbotics

       As per CERN-OHL-S v2 section 4, should You produce hardware based on
     these sources, You must maintain the Source Location clearly visible on
     the external case of the CNC Controller or other product you make using
                                   this Source.

                 For more information, email info@buildbotics.com

\******************************************************************************/

.view-control
  max-width limit-width
  margin auto

  #control
    display flex
    flex-direction column

    > *
      margin 0.25em 0
      
    // =====================================================
    // TOP SECTION: Axis table + User panel side by side
    // =====================================================
    .control-top
      display flex
      gap 1em
      align-items stretch  // User panel height matches axis section

    .axis-section
      flex 1
      min-width 0

  table
    border-collapse collapse

    td, th
      border 1px solid #ddd

  // =====================================================
  // AXIS TABLE
  // =====================================================
  .axes
    width 100%
    
    .axis-x .name
      color #f00

    .axis-y .name
      color #0f0

    .axis-z .name
      color #00f

    .axis-a .name
      color #f80

    .axis-b .name
      color #0ff

    .axis-c .name
      color #f0f

    td, th
      padding 4px 8px
      white-space nowrap

    th
      text-align center
      vertical-align bottom
      background #f8f8f8
      font-weight 600
      color #555

    td
      text-align right
      font-family Courier

    .homed
      background-color #ccffcc
      color #000

    .warn
      background-color #ffffcc

    .error
      background-color #ffcccc

    .axis
      .name
        text-transform capitalize
        min-width 2.5em
        font-weight 600

      .name, .position
        font-size 24pt
        line-height 28pt

      .position
        width auto
        min-width 5em

      td.state
        text-align left
        min-width 6em
        font-family inherit
        font-size 0.9em

      .absolute, .offset
        min-width 5em
        font-size 0.95em

    // Header row
    tr:first-child
      th
        font-size 0.85em
        text-transform uppercase
        letter-spacing 0.5px
        
      th.actions
        text-align center
        
      // Reset icon size in header (not affected by th font-size)
      .icon-btn
        font-size 1rem
        
      .fa-cog
        font-size 1rem

    // Axis name header with gear icon
    .name-header
      display flex
      align-items center
      gap 0.5em
      
      span
        flex 1

    // Column selector dropdown - LEFT ALIGNED
    .column-selector
      position relative
      
      > .fa-cog
        cursor pointer
        padding 0.25em
        color #888
        
        &:hover
          color #333
      
      .column-menu
        position absolute
        top 100%
        left 0
        background #fff
        border 1px solid #ddd
        border-radius 4px
        box-shadow 0 4px 12px rgba(0,0,0,0.15)
        padding 0.5em
        z-index 100
        min-width 120px
        
        label
          display flex
          align-items center
          padding 0.25em 0.5em
          cursor pointer
          white-space nowrap
          font-weight normal
          text-transform none
          letter-spacing 0
          font-size 0.95em
          text-align left
          
          &:hover
            background #f5f5f5
          
          input
            margin-right 0.5em
            flex-shrink 0

    // Actions header with icon buttons
    // Axis header actions - inline and dropdown variants
    .actions-inline
      display flex
      justify-content center
      align-items center
      gap 0.75em

    .actions-dropdown
      display none
      
      .nav-item
        padding 0.35em
        cursor pointer
        
        .fa-ellipsis-v
          color #555
          font-size 1.1em
          
        &:hover .fa-ellipsis-v
          color #0078e7

    // Icon-only buttons (no background)
    .icon-btn
      cursor pointer
      padding 0.35em
      color #555
      font-size 1.1em
      transition color 0.15s ease
      
      &:hover
        color #0078e7
      
      &.disabled
        opacity 0.4
        pointer-events none
        cursor not-allowed

    // Action buttons column
    .actions
      white-space nowrap
      text-align center
      width 1%

      .actions-inline
        display flex
        gap 0.5em
        justify-content center
        
      .actions-dropdown
        display none
        position relative
        
        > .nav-item
          padding 0.5em
          cursor pointer
          color #555
          
          &:hover
            background rgba(0,0,0,0.05)
            
          > .nav-menu.nav-menu-open
            display block
            
          > .nav-menu
            display none
            position absolute
            top 100%
            right 0
            left auto
            min-width 140px
            background #fff
            border 1px solid #ddd
            border-radius 4px
            box-shadow 0 4px 12px rgba(0,0,0,0.15)
            z-index 100
            
            > a
              padding 0.6em 1em
              display flex
              align-items center
              gap 0.5em
              color #333
              white-space nowrap
              text-decoration none
              font-weight normal
              
              &:hover
                background #f5f5f5
              
              &.disabled
                opacity 0.5
                pointer-events none

  // =====================================================
  // USER PANEL (right side)
  // =====================================================
  .user-panel
    width 280px
    min-width 280px
    border 1px solid #ddd
    border-radius 4px
    background #fff
    display flex
    flex-direction column
    overflow hidden  // Prevent content from growing panel
    // Height set by align-items: stretch on parent .control-top

  .user-panel-tabs
    flex-shrink 0  // Don't shrink tabs
    display flex
    border-bottom 1px solid #ddd
    background #f8f8f8
    
    .user-panel-tab
      flex 1
      padding 0.5em
      text-align center
      cursor pointer
      font-size 0.9em
      font-weight 600
      color #666
      border-bottom 2px solid transparent
      
      .fa
        margin-right 0.25em
      
      &:hover
        background #f0f0f0
      
      &.active
        color #333
        border-bottom-color #0078e7
        background #fff

  .user-panel-content
    flex 1
    min-height 0
    overflow hidden
    position relative  // Positioning context for panel children

  // Program tab
  .panel-program
    padding 0.75em
    display flex
    flex-direction column
    gap 0.75em

  .program-info
    .program-filename
      font-weight 600
      font-size 0.95em
      margin-bottom 0.25em
      
      .fa
        margin-right 0.25em
        color #666
      
      &.no-file
        color #999
        font-style italic
    
    .program-meta
      font-size 0.85em
      color #666

  .program-actions
    display flex
    flex-direction column
    gap 0.5em
    
    .action-row
      display flex
      gap 0.5em
      
      button, .bbutton
        flex 1

  // MDI tab
  .panel-mdi
    position absolute
    top 0
    left 0
    right 0
    bottom 0
    padding 0.75em
    box-sizing border-box

  .mdi-input-row
    margin-bottom 0.5em
    
    .mdi-commands
      width 100%
      padding 0.5em
      border 1px solid #ccc
      border-radius 4px
      font-size 1rem
      
    .mdi-input
      width 100%
      padding 0.5em
      border 1px solid #ccc
      border-radius 4px
      font-family monospace
      font-size 1rem
      box-sizing border-box

  .mdi-buttons
    margin-bottom 0.5em
    display flex
    gap 0.5em
    
    button, .bbutton
      flex 1

  .mdi-history
    height calc(100% - 11em)  // Fill remaining after dropdown, input, buttons + padding
    overflow-y auto
    background #fafafa
    border-radius 4px
    padding 0.5em
    font-family courier
    font-size 0.9em
    
    &.placeholder
      color #aaa
      font-style italic
    
    .history-label
      font-weight 600
      color #666
      margin-bottom 0.25em
      font-family inherit
    
    ul
      margin 0
      padding 0
      list-style none
      
      li
        cursor pointer
        padding 0.25em 0.5em
        border-radius 3px
        
        &:hover
          background #e8e8e8

  // JOG MODAL
  .jog-modal
    .modal-body
      padding 1em
    
  .jog-modal-content
    display flex
    flex-direction column
    align-items center
    
  .jog-controls
    display flex
    flex-direction row
    flex-wrap nowrap
    justify-content center
    gap 1em
    
    > *
      flex-shrink 0

  .jog-settings
    display flex
    justify-content center
    gap 2em
    margin 1em 0
    padding 1em
    background #f8f8f8
    border-radius 4px
    width 100%
    box-sizing border-box
    
  .jog-adjust, .jog-mode
    display flex
    align-items center
    gap 0.5em
    font-size 0.9em
    
    label
      font-weight normal

  .jog-instructions
    text-align center
    color #666
    font-size 0.85em
    padding 0.5em
    
    p
      margin 0.25em 0

  // JOG SVG CONTROLS
  // =====================================================
  .jog svg
    user-select none
    -webkit-touch-callout none
    -webkit-user-select none

    text
      font-family Sans
      font-weight bold
      stroke transparent
      fill #444

    .button
      cursor pointer
      stroke #4c4c4c

      &:hover
        stroke #e55

    .house
      stroke #444
      fill #444

    .ring
      cursor pointer

      .button
        stroke transparent

        &:hover
          stroke #e55

        text
          font-size 10pt
          text-anchor middle

  // =====================================================
  .macros
    display grid
    grid-template-columns repeat(8, 1fr)
    column-gap 1%
    row-gap 8px
    padding 0.5em

    // FIX: Button text overflow - allow text to wrap
    .macro
      text-align center
      overflow hidden
      // FIX: Remove text-overflow ellipsis and white-space nowrap
      // to allow long names to wrap to multiple lines
      white-space normal
      word-wrap break-word
      overflow-wrap break-word
      padding 0.5em 0.25em
      min-height 2.5em
      display flex
      align-items center
      justify-content center
      font-size 14px
      line-height 1.2

      &:hover
        background-image button-hover

      .fa
        margin-right 0.25em

  // =====================================================
  // INFO TABLES
  // =====================================================
  .info-blocks
    display grid
    grid-template-columns repeat(3, 1fr)
    gap 0.5em
    margin-top 0.5em

  .info
    empty-cells show
    background #fff
    border-radius 4px
    width 100%

    th, td
      height 1.5em
      padding 4px 8px
      text-align right
      overflow hidden
      text-overflow ellipsis
      white-space nowrap

    th
      min-width 5em
      width 5em
      background #f8f8f8
      font-weight 600
      color #555

    td
      min-width 5em
      width 100%

    .progress
      height 1.75em
      position relative

      label
        position relative
        z-index 1
        float right

      .bar
        position absolute
        top 0
        left 0
        height 100%
        background #f2ac45
        border-radius 2px

  // =====================================================
  .toolbar
    display flex
    flex-wrap wrap
    clear both
    padding 0.5em
    background #f5f5f5
    border-radius 4px
    margin-bottom 0.5em
  // MACROS
  .macros-container
    margin-top 0.5em

  .macro-tabs
    display flex
    flex-wrap wrap
    gap 0.25em
    
    .macro-tab
      padding 0.4em 0.75em
      background #f0f0f0
      border-radius 4px 4px 0 0
      cursor pointer
      font-size 0.85em
      
      &:hover
        background #e8e8e8
      
      &.active
        background #fff
        border 1px solid #ddd
        border-bottom-color #fff
        margin-bottom -1px
      
      &.settings-tab
        margin-left auto
        background #fff
        // FIX #9: Match Clear button border style (no visible bottom border)
        border-top 1px solid #ddd
        border-left 1px solid #ddd
        border-right 1px solid #ddd
        border-bottom 1px solid #fff
        margin-bottom -1px
        color #666
        text-decoration none
        
        .fa
          margin-right 0.25em
        
        &:hover
          background #f8f8f8

    .filename
      flex 1
      text-align right
      color #666
      font-style italic
      align-self center

  // =====================================================
  // TABS
  // =====================================================
  .tabs
    margin-top 0.5em
    
    // Clear action styled as a tab on the far right
    .tab-action
      float right
      padding 0.5em 1em
      font-weight bold
      cursor pointer
      text-decoration none
      text-align center
      background #fff
      border-top-left-radius 5px
      border-top-right-radius 5px
      border-top 2px solid #ddd
      border-left 1px solid #ddd
      border-right 1px solid #ddd
      border-bottom 1px solid #fff
      margin-bottom -1px
      color #666
      
      .fa
        margin-right 0.25em
      
      &:hover
        background-image button-hover
        color #333
    
    section
      min-height 300px
      overflow-x hidden
      overflow-y auto
      padding 0
      margin 0

  .CodeMirror
    height 350px

  .gcode-view
    font-family courier
    overflow auto
    height 350px
    white-space nowrap

    &.placeholder
      color #aaa

  .history
    padding 0.5em
    background #fafafa
    border-radius 4px

  .history ul
    margin 0
    padding 0
    list-style none

    li
      cursor pointer
      padding 0.25em 0.5em
      border-radius 3px
      
      &:hover
        background #e8e8e8

  // =====================================================
  // MDI
  // =====================================================
  .mdi
    clear both
    white-space nowrap
    padding 0.5em
    display flex
    background #f5f5f5
    border-radius 4px
    gap 0.5em

    button, .bbutton
      flex-shrink 0

    input
      flex 1
      padding 0.5em
      border 1px solid #ccc
      border-radius 4px
      font-family monospace

  // =====================================================
  // JOG
  // =====================================================
  .jog
    text-align center

    > svg
      margin 1em
      
      // Visual feedback when jog controls are disabled (program running)
      &.disabled
        opacity 0.4
        pointer-events none
        cursor not-allowed

  .jog-settings
    display flex
    justify-content center
    gap 2em
    margin 1em 0
    
  .jog-adjust, .jog-mode
    display flex
    align-items center
    gap 0.5em

  .jog-adjust input
    vertical-align middle

  .jog-instructions
    text-align center
    color #666
    font-size 0.9em
    
    p
      margin 0.5em 0

.load-on
  background-color #ccffcc
  color #000


// =====================================================
// RESPONSIVE BREAKPOINTS
// =====================================================

// Large screens - more macro columns
@media only screen and (min-width 1350px)
  .view-control #control
    .macros
      grid-template-columns repeat(12, 1fr)

// Medium screens - stack layout
@media only screen and (max-width 1100px)
  .view-control #control
    .control-top
      flex-direction column
    
    .user-panel
      width 100%
      min-width 100%
      // FIX #6/#7: Maintain minimum height for MDI history on mobile
      min-height 280px
      max-height 400px

@media only screen and (max-width 940px)
  .view-control #control
    .axes
      .axis
        .name, .position
          font-size 18pt
          line-height 20pt

      .absolute, .offset
        display none

    .macros
      grid-template-columns repeat(6, 1fr)

    .info-blocks
      grid-template-columns 1fr
      
  .jog-controls
    flex-direction column

@media only screen and (max-width 600px)
  // FIX #2/#3: Prevent horizontal scroll on control page
  // NOTE: Do NOT use overflow-x:hidden on .view-control as it creates
  // a separate scroll context that makes header/alerts appear sticky
  .view-control
    padding 0 0.5em 80px 0.5em
    
    #control
      max-width 100%
      
      .control-top
        max-width 100%
        
      .axis-section
        max-width 100%
        overflow-x auto  // Allow axis table to scroll if needed
        
      .axes
        // Allow table to be responsive
        display block
        overflow-x auto
        
        .axis
          .name, .position
            font-size 16pt
            line-height 18pt

        .actions
          .actions-inline
            display none
            
          .actions-dropdown
            display block
        
        // FIX #4: Axis header actions - dropdown on mobile
        thead th.actions
          .actions-inline
            display none
          .actions-dropdown
            display block
        
        // FIX #5: Hide column selector on mobile - defaults are sensible
        .column-selector
          display none
        
      .macros
        grid-template-columns repeat(4, 1fr)

  // FIX #8: Jog modal SVGs - stack vertically and scale on small screens
  .jog-modal
    .modal-body
      padding 0.5em
      
    .jog-modal-content
      width 100%
      max-width 100%
      overflow hidden
      
    .jog-controls
      flex-direction column !important
      align-items center
      gap 0.5em
      width 100%
      
      > *
        flex-shrink 1 !important
        max-width 100%
        
      // Make SVGs small enough to fit mobile screens
      svg
        width 200px !important
        height 200px !important
        max-width 90vw
        max-height 90vw
